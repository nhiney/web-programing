@model List<WebBanGIay.Models.CartItem>
@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var listGoiY = ViewBag.SanPhamGoiY as List<WebBanGIay.Models.SANPHAM>;
    decimal tongTienHang = ViewBag.TongTien != null ? (decimal)ViewBag.TongTien : 0;
}

<link href="~/Content/Css/Cart.css" rel="stylesheet" type="text/css" />

<div class="container">
    <div class="cart-header">
        <h2><i class="fas fa-shopping-cart"></i> Giỏ hàng của bạn</h2>
        <div class="cart-breadcrumb">
            <a href="/">Trang chủ</a>
            <span>></span>
            <a href="/Products">Sản phẩm</a>
            <span>></span>
            <span class="active">Giỏ hàng</span>
        </div>
    </div>

    @if (Model != null && Model.Count > 0)
    {
        <div class="cart-container">
            <div class="cart-items-container">
                <div class="cart-items-header">
                    <div class="select-all">
                        <input type="checkbox" id="selectAll" checked>
                    </div>
                    <div class="product-header">Sản phẩm</div>
                    <div class="quantity-header">Số lượng</div>
                    <div class="price-header">Thành tiền</div>
                    <div class="action-header"></div>
                </div>

                @foreach (var item in Model)
                {
                    <div class="cart-item" data-price="@item.DonGia" data-id="@item.MaSP" data-size="@item.Size" data-mau="@item.Mau">
                        <div class="cart-item-checkbox">
                            <input type="checkbox" class="item-checkbox" checked>
                        </div>

                        <img src="@(string.IsNullOrWhiteSpace(item.HinhAnh) ? "/source/images/products/no-image.jpg" : "/source/images/products/" + item.HinhAnh)"
                             alt="@item.TenSP"
                             class="cart-item-image"
                             loading="lazy">

                        <div class="cart-item-details">
                            <div class="cart-item-name">
                                <a href="/Products/ChiTiet/@item.MaSP">@item.TenSP</a>
                            </div>
                            <div class="cart-item-code">Mã: @item.MaSP</div>
                            <div class="cart-item-options">
                                <span class="cart-item-option">Size: @item.Size</span>
                                <span class="cart-item-option">Màu: @item.Mau</span>
                            </div>
                        </div>

                        <div class="cart-item-quantity">
                            <form action="@Url.Action("Update", "Cart")" method="post" class="qty-form">
                                <input type="hidden" name="id" value="@item.MaSP" />
                                <input type="hidden" name="size" value="@item.Size" />
                                <input type="hidden" name="mau" value="@item.Mau" />
                                <div class="quantity-control">
                                    <button type="button" class="quantity-btn decrease">-</button>
                                    <input type="text" name="soLuong" class="quantity-input" value="@item.SoLuong" readonly />
                                    <button type="button" class="quantity-btn increase">+</button>
                                </div>
                            </form>
                        </div>

                        <div class="cart-item-price">
                            @item.ThanhTien.ToString("N0") đ
                        </div>

                        <div class="cart-item-action">
                            <a href="@Url.Action("Remove", "Cart", new { id = item.MaSP, size = item.Size, mau = item.Mau })"
                               class="remove-btn"
                               title="Xóa sản phẩm">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </div>
                }

                <div class="cart-actions">
                    <a href="@Url.Action("Clear", "Cart")" class="clear-cart-btn" onclick="return confirm('Bạn chắc chắn muốn xóa hết giỏ hàng?');">
                        <i class="fas fa-trash-alt"></i> Xóa tất cả
                    </a>
                    <a href="/" class="continue-shopping-btn">
                        <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
                    </a>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary">
                <h3 class="summary-title">Tóm tắt đơn hàng</h3>
                <div class="summary-row">
                    <span>Tạm tính (@Model.Sum(x => x.SoLuong) sản phẩm)</span>
                    <span id="subtotal-display">@tongTienHang.ToString("N0") đ</span>
                </div>
                <div class="summary-row">
                    <span>Phí vận chuyển</span>
                    <span style="color: var(--success-color);">Miễn phí</span>
                </div>

                <div class="promo-code">
                    <div class="summary-row">
                        <span>Mã giảm giá</span>
                        <a href="#" style="color: var(--primary-color); text-decoration: none;">Chọn mã</a>
                    </div>
                    <div class="promo-code-form">
                        <input type="text" class="promo-input" placeholder="Nhập mã giảm giá">
                        <button class="promo-btn">Áp dụng</button>
                    </div>
                </div>

                <div class="summary-row total">
                    <span>Tổng cộng</span>
                    <span id="total-price-display">@tongTienHang.ToString("N0") đ</span>
                </div>

                <a href="@Url.Action("Checkout", "Cart")" class="checkout-btn">
                    <i class="fas fa-lock"></i> TIẾN HÀNH THANH TOÁN
                </a>

                <div class="payment-methods">
                    <div class="payment-methods-title">Chúng tôi chấp nhận:</div>
                    <div class="payment-icons">
                        <img src="/source/images/payment/cod.png" alt="COD" class="payment-icon">
                        <img src="/source/images/payment/momo.png" alt="MoMo" class="payment-icon">
                        <img src="/source/images/payment/zalopay.png" alt="ZaloPay" class="payment-icon">
                        <img src="/source/images/payment/vnpay.png" alt="VNPay" class="payment-icon">
                        <img src="/source/images/payment/visa.png" alt="Visa" class="payment-icon">
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Suggestions -->
        if (listGoiY != null && listGoiY.Count > 0)
        {
            <div class="suggestions">
                <div class="suggestions-header">
                    <h3 class="suggestions-title">Có thể bạn sẽ thích</h3>
                    <a href="/Products" class="view-all-btn">Xem tất cả <i class="fas fa-arrow-right"></i></a>
                </div>

                <div class="product-grid">
                    @foreach (var sp in listGoiY)
                    {
                        double phanTramGiamSP = 0;
                        if (sp.GIA > 0 && sp.GIAKHUYENMAI > 0 && sp.GIAKHUYENMAI < sp.GIA)
                        {
                            phanTramGiamSP = Math.Round((double)((sp.GIA - sp.GIAKHUYENMAI) / sp.GIA * 100));
                        }

                        <div class="product-card">
                            <div class="product-image-container">
                                @if (sp.GIAKHUYENMAI > 0 && sp.GIAKHUYENMAI < sp.GIA)
                                {
                                    <div class="product-discount">-@phanTramGiamSP%</div>
                                }
                                <img src="@(string.IsNullOrWhiteSpace(sp.HINHANH) ? "/source/images/products/no-image.jpg" : "/source/images/products/" + sp.HINHANH)"
                                     alt="@sp.TENSANPHAM"
                                     class="product-image"
                                     loading="lazy">
                                <div class="product-actions">
                                    <button class="product-action-btn" title="Thêm vào yêu thích">
                                        <i class="far fa-heart"></i>
                                    </button>
                                    <button class="product-action-btn" title="Xem nhanh">
                                        <i class="far fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="product-details">
                                <h4 class="product-name">@sp.TENSANPHAM</h4>
                                <div class="product-price">
                                    @if (sp.GIAKHUYENMAI > 0 && sp.GIAKHUYENMAI < sp.GIA)
                                    {
                                        <span class="price-current">@String.Format("{0:N0}", sp.GIAKHUYENMAI)đ</span>
                                        <span class="price-original">@String.Format("{0:N0}", sp.GIA)đ</span>
                                    }
                                    else
                                    {
                                        <span class="price-current">@String.Format("{0:N0}", sp.GIA)đ</span>
                                    }
                                </div>
                                <button class="add-to-cart-btn" data-id="@sp.MASANPHAM">
                                    <i class="fas fa-shopping-cart"></i> Thêm vào giỏ
                                </button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="empty-cart">
                <div class="empty-cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h3 class="empty-cart-title">Giỏ hàng trống</h3>
                <p class="empty-cart-text">Bạn chưa có sản phẩm nào trong giỏ hàng</p>
                <a href="/" class="empty-cart-btn">
                    <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
                </a>
            </div>
        }
    }
    else
    {
        <div class="empty-cart">
            <h3>Giỏ hàng của bạn đang trống!</h3>
            <a href="/" class="empty-cart-btn">
                <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
            </a>
        </div>
    }
</div>
