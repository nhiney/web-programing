@model List<WebBanGIay.Models.CartItem>
@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var listGoiY = ViewBag.SanPhamGoiY as List<WebBanGIay.Models.SANPHAM>;
    decimal tongTienHang = ViewBag.TongTien != null ? (decimal)ViewBag.TongTien : 0;
}

<link href="~/Content/Css/Cart.css" rel="stylesheet" type="text/css" />

<div class="container">
    <div class="cart-header">
        <h2><i class="fas fa-shopping-cart"></i> Giỏ hàng của bạn</h2>
        <div class="cart-breadcrumb">
            <a href="/">Trang chủ</a>
            <span>></span>
            <a href="/Products">Sản phẩm</a>
            <span>></span>
            <span class="active">Giỏ hàng</span>
        </div>
    </div>

    @if (Model != null && Model.Count > 0)
    {
        <div class="cart-container">
            <div class="cart-items-container">
                <div class="cart-items-header">
                    <div class="select-all">
                        <input type="checkbox" id="selectAll" checked>
                    </div>
                    <div class="product-header">Sản phẩm</div>
                    <div class="quantity-header">Số lượng</div>
                    <div class="price-header">Thành tiền</div>
                    <div class="action-header"></div>
                </div>

                @foreach (var item in Model)
                {
                    <div class="cart-item" data-price="@item.DonGia" data-id="@item.MaSP" data-size="@item.Size" data-mau="@item.Mau">
                        <div class="cart-item-checkbox">
                            <input type="checkbox" class="item-checkbox" checked>
                        </div>

                        <img src="@(string.IsNullOrWhiteSpace(item.HinhAnh) ? "/source/images/products/no-image.jpg" : "/source/images/products/" + item.HinhAnh)"
                             alt="@item.TenSP"
                             class="cart-item-image"
                             loading="lazy">

                        <div class="cart-item-details">
                            <div class="cart-item-name">
                                <a href="/Products/ChiTiet/@item.MaSP">@item.TenSP</a>
                            </div>
                            <div class="cart-item-code">Mã: @item.MaSP</div>
                            <div class="cart-item-options">
                                <span class="cart-item-option">Size: @item.Size</span>
                                <span class="cart-item-option">Màu: @item.Mau</span>
                            </div>
                        </div>

                        <div class="cart-item-quantity">
                            <form action="@Url.Action("Update", "Cart")" method="post" class="qty-form">
                                <input type="hidden" name="id" value="@item.MaSP" />
                                <input type="hidden" name="size" value="@item.Size" />
                                <input type="hidden" name="mau" value="@item.Mau" />
                                <div class="quantity-control">
                                    <button type="button" class="quantity-btn decrease">-</button>
                                    <input type="text" name="soLuong" class="quantity-input" value="@item.SoLuong" readonly />
                                    <button type="button" class="quantity-btn increase">+</button>
                                </div>
                            </form>
                        </div>

                        <div class="cart-item-price">
                            @item.ThanhTien.ToString("N0") đ
                        </div>

                        <div class="cart-item-action">
                            <a href="@Url.Action("Remove", "Cart", new { id = item.MaSP, size = item.Size, mau = item.Mau })"
                               class="remove-btn"
                               title="Xóa sản phẩm">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </div>
                }

                <div class="cart-actions">
                    <a href="@Url.Action("Clear", "Cart")" class="clear-cart-btn" onclick="return confirm('Bạn chắc chắn muốn xóa hết giỏ hàng?');">
                        <i class="fas fa-trash-alt"></i> Xóa tất cả
                    </a>
                    <a href="/" class="continue-shopping-btn">
                        <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
                    </a>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary">
                <h3 class="summary-title">Tóm tắt đơn hàng</h3>
                <div class="summary-row">
                    <span>Tạm tính (@Model.Sum(x => x.SoLuong) sản phẩm)</span>
                    <span id="subtotal-display">@tongTienHang.ToString("N0") đ</span>
                </div>
                <div class="summary-row">
                    <span>Phí vận chuyển</span>
                    <span style="color: var(--success-color);">Miễn phí</span>
                </div>

                <div class="promo-code">
                    <div class="summary-row">
                        <span>Mã giảm giá</span>
                        <a href="#" style="color: var(--primary-color); text-decoration: none;">Chọn mã</a>
                    </div>
                    <div class="promo-code-form">
                        <input type="text" class="promo-input" placeholder="Nhập mã giảm giá">
                        <button class="promo-btn">Áp dụng</button>
                    </div>
                </div>

                <div class="summary-row total">
                    <span>Tổng cộng</span>
                    <span id="total-price-display">@tongTienHang.ToString("N0") đ</span>
                </div>

                <a href="@Url.Action("Checkout", "Cart")" class="checkout-btn">
                    <i class="fas fa-lock"></i> TIẾN HÀNH THANH TOÁN
                </a>

                <div class="payment-methods">
                    <div class="payment-methods-title">Chúng tôi chấp nhận:</div>
                    <div class="payment-icons">
                        <img src="/source/images/payment/cod.png" alt="COD" class="payment-icon">
                        <img src="/source/images/payment/momo.png" alt="MoMo" class="payment-icon">
                        <img src="/source/images/payment/zalopay.png" alt="ZaloPay" class="payment-icon">
                        <img src="/source/images/payment/vnpay.png" alt="VNPay" class="payment-icon">
                        <img src="/source/images/payment/visa.png" alt="Visa" class="payment-icon">
                    </div>
                </div>
            </div>
        </div>

    }
    else
    {
        <div class="empty-cart">
            <div class="empty-cart-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h3 class="empty-cart-title">Giỏ hàng trống</h3>
            <p class="empty-cart-text">Bạn chưa có sản phẩm nào trong giỏ hàng</p>
            <a href="/" class="empty-cart-btn">
                <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
            </a>
        </div>
    }
    @if (listGoiY != null && listGoiY.Any())
    {
        <div class="row mt-5">
            <div class="col-12">
                <h3 class="mb-4 fw-bold border-bottom pb-2">Có thể bạn sẽ thích</h3>
            </div>
            @foreach (var item in listGoiY)
            {
                <div class="col-md-3 col-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm product-card">
                         <div class="position-relative overflow-hidden">
                            <img src="@(string.IsNullOrWhiteSpace(item.HINHANH) ? "/source/images/products/no-image.jpg" : "/source/images/products/" + item.HINHANH)"
                                 class="card-img-top" alt="@item.TENSANPHAM" style="height: 200px; object-fit: cover;">
                            @if (item.GIAKHUYENMAI > 0)
                            {
                                <div class="position-absolute top-0 end-0 bg-danger text-white px-2 py-1 m-2 rounded-pill small fw-bold">Sale</div>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title text-truncate">
                                <a href="@Url.Action("ChiTiet", "Products", new { id = item.MASANPHAM.Trim() })" class="text-dark text-decoration-none">@item.TENSANPHAM</a>
                            </h6>
                            <div class="mt-auto">
                                @if (item.GIAKHUYENMAI.HasValue && item.GIAKHUYENMAI > 0)
                                {
                                    <span class="text-danger fw-bold me-2">@string.Format("{0:N0}", item.GIAKHUYENMAI) ₫</span>
                                    <small class="text-muted text-decoration-line-through">@string.Format("{0:N0}", item.GIA) ₫</small>
                                }
                                else
                                {
                                    <span class="text-danger fw-bold">@string.Format("{0:N0}", item.GIA) ₫</span>
                                }
                            </div>
                            <a href="@Url.Action("ChiTiet", "Products", new { id = item.MASANPHAM.Trim() })" class="btn btn-outline-primary btn-sm mt-2 rounded-pill w-100">Xem ngay</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    .product-card { transition: transform 0.3s; }
    .product-card:hover { transform: translateY(-5px); }
</style>
