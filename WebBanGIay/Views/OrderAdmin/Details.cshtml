@model WebBanGIay.Models.HOADON
@{
    ViewBag.Title = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .page-container {
        padding: 24px;
        color: var(--text-main);
    }
    .card-custom {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: var(--shadow-card);
    }
    .card-header-custom {
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
    }
    .table-details {
        width: 100%;
        color: var(--text-main);
    }
    .table-details th {
        width: 140px;
        color: var(--text-label);
        font-weight: 600;
        padding: 12px 0;
        vertical-align: top;
    }
    .table-details td {
        padding: 12px 0;
        vertical-align: top;
    }
    .table-products {
        color: var(--text-main);
        width: 100%;
    }
    .table-products thead th {
        color: var(--text-label);
        font-weight: 600;
        border-bottom: 1px solid var(--border-color);
        padding: 12px;
    }
    .table-products td {
        padding: 12px;
        border-bottom: 1px solid var(--border-color);
        vertical-align: middle;
    }
</style>

<div class="page-container">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success mb-4 border-0 shadow-sm"><i class="bi bi-check-circle me-2"></i>@TempData["Success"]</div>
    }

    <div class="row">
        <div class="col-lg-4 mb-4">
            <div class="card card-custom h-100">
                <div class="card-header-custom">
                    <h5 class="mb-0 fw-bold text-main"><i class="bi bi-receipt text-warning me-2"></i>Thông tin đơn hàng</h5>
                </div>
                <div class="card-body p-4">
                    <table class="table-details">
                        <tr>
                            <th>Mã đơn:</th>
                            <td class="fw-bold text-primary">@Model.MAHOADON</td>
                        </tr>
                        <tr>
                            <th>Ngày lập:</th>
                            <td class="text-muted">@(Model.NGAYLAP?.ToString("dd/MM/yyyy HH:mm"))</td>
                        </tr>
                        <tr>
                            <th>Khách hàng:</th>
                            <td>@(Model.KHACHHANG?.HOTEN ?? "Khách vãng lai")</td>
                        </tr>
                        <tr>
                            <th>Tổng tiền:</th>
                            <td class="text-success fw-bold fs-5">@string.Format("{0:N0}", Model.TONGTIEN) đ</td>
                        </tr>
                        <tr>
                            <th>Trạng thái:</th>
                            <td>
                                @{
                                    var badgeClass = "bg-secondary";
                                    var statusIcon = "";
                                    if (Model.TRANGTHAI == "HOÀN THÀNH") { 
                                        badgeClass = "bg-success"; 
                                        statusIcon = "bi-check-circle-fill";
                                    }
                                    else if (Model.TRANGTHAI == "CHỜ XỬ LÝ") { 
                                        badgeClass = "bg-warning text-dark"; 
                                        statusIcon = "bi-hourglass-split";
                                    }
                                    else if (Model.TRANGTHAI == "ĐÃ GIAO") { 
                                        badgeClass = "bg-info text-dark"; 
                                        statusIcon = "bi-truck";
                                    }
                                    else if (Model.TRANGTHAI == "ĐÃ HỦY") { 
                                        badgeClass = "bg-danger"; 
                                        statusIcon = "bi-x-circle-fill";
                                    }
                                }
                                <span class="badge @badgeClass py-2 px-3">
                                    <i class="bi @statusIcon me-1"></i>@Model.TRANGTHAI
                                </span>
                            </td>
                        </tr>
                    </table>
                    
                    <div class="mt-4 pt-3 border-top" style="border-color: var(--border-color) !important;">
                        <div class="d-grid gap-2">
                             <a href="@Url.Action("Edit", new { id = Model.MAHOADON })" class="btn btn-warning fw-bold">
                                <i class="bi bi-pencil-square me-2"></i>Cập nhật trạng thái
                            </a>
                             <a href="@Url.Action("Delete", new { id = Model.MAHOADON })" class="btn btn-outline-danger">
                                <i class="bi bi-trash me-2"></i>Xóa đơn hàng
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-8 mb-4">
            <div class="card card-custom h-100">
                <div class="card-header-custom d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold text-main"><i class="bi bi-box-seam text-info me-2"></i>Danh sách sản phẩm</h5>
                    <span class="badge bg-primary bg-opacity-10 text-primary">@Model.CHITIET_HOADON.Count sản phẩm</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                    <table class="table-products">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th class="text-center">Số lượng</th>
                                <th class="text-end">Đơn giá</th>
                                <th class="text-end">Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.CHITIET_HOADON != null && Model.CHITIET_HOADON.Any())
                            {
                                foreach (var detail in Model.CHITIET_HOADON)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="rounded bg-secondary bg-opacity-10 p-2 me-3">
                                                    <i class="bi bi-box2 text-muted fs-4"></i>
                                                </div>
                                                <div>
                                                    <div class="fw-bold">@(detail.SANPHAM?.TENSANPHAM ?? "Đã xóa")</div>
                                                    <small class="text-muted">Mã: @detail.MASANPHAM</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-secondary">x @detail.SOLUONG</span>
                                        </td>
                                        <td class="text-end text-muted">@string.Format("{0:N0}", detail.DONGIA) đ</td>
                                        <td class="text-end fw-bold text-success">@string.Format("{0:N0}", detail.SOLUONG * detail.DONGIA) đ</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-4">Không có sản phẩm nào</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background: var(--bg-hover);">
                                <td colspan="3" class="text-end fw-bold p-3 text-label">TỔNG CỘNG:</td>
                                <td class="text-end fw-bold text-success p-3 fs-5">@string.Format("{0:N0}", Model.TONGTIEN) đ</td>
                            </tr>
                        </tfoot>
                    </table>
                    </div>
                </div>
                 <div class="card-footer border-0 bg-transparent p-3 text-end">
                     <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>Quay lại danh sách
                    </a>
                 </div>
            </div>
        </div>
    </div>
</div>
