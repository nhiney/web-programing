@model WebBanGIay.Models.DashboardViewModel
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* Dashboard Container */
    .dashboard-wrapper {
        padding: 24px;
        color: var(--text-main);
    }

    /* Summary Cards */
    .summary-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 28px 20px;
        text-align: center;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-card);
        position: relative;
        overflow: hidden;
        height: 100%;
    }

    .summary-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #4e73df, #1cc88a);
    }

    .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        border-color: var(--accent-color);
    }

    .summary-card i {
        font-size: 52px;
        margin-bottom: 14px;
        display: block;
        opacity: 0.9;
    }

    .summary-card h4 {
        font-size: 36px;
        font-weight: 800;
        color: var(--text-main);
        margin: 10px 0;
        /* text-shadow: 0 2px 8px rgba(0,0,0,0.3); Removed shadow for cleaner light mode */
    }

    .summary-card p {
        font-size: 13px;
        color: var(--text-label); /* changed from text-muted for better visibility */
        text-transform: uppercase;
        letter-spacing: 1.2px;
        margin: 0;
        font-weight: 600;
    }

    /* Icon Colors - Keep specific colors as they look good in both modes */
    .col-md-3:nth-child(1) .summary-card i { color: #4e73df; }
    .col-md-3:nth-child(2) .summary-card i { color: #1cc88a; }
    .col-md-3:nth-child(3) .summary-card i { color: #36b9cc; }
    .col-md-3:nth-child(4) .summary-card i { color: #f6c23e; }

    /* Chart Cards */
    .card-custom {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        box-shadow: var(--shadow-card);
        height: 100%;
    }

    .card-custom h5 {
        color: var(--text-main);
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 20px;
        padding-bottom: 14px;
        border-bottom: 2px solid var(--border-color);
    }

    .chart-wrapper {
        position: relative;
        height: 280px;
        padding: 10px;
    }

    .chart-wrapper canvas {
        max-height: 100%;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .summary-card {
            margin-bottom: 16px;
        }
        
        .chart-wrapper {
            height: 240px;
        }
    }
</style>

<div class="dashboard-wrapper">

<!-- SUMMARY CARDS -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="summary-card">
            <i class="bi bi-people"></i>
            <h4>@Model.TotalUsers</h4>
            <p>Người dùng</p>
        </div>
    </div>

    <div class="col-md-3">
        <div class="summary-card">
            <i class="bi bi-bag"></i>
            <h4>@Model.TotalProducts</h4>
            <p>Sản phẩm</p>
        </div>
    </div>

    <div class="col-md-3">
        <div class="summary-card">
            <i class="bi bi-receipt"></i>
            <h4>@Model.TotalOrders</h4>
            <p>Đơn hàng</p>
        </div>
    </div>

    <div class="col-md-3">
        <div class="summary-card">
            <i class="bi bi-cash"></i>
            <h4>@Model.TotalRevenue.ToString("N0") đ</h4>
            <p>Doanh thu</p>
        </div>
    </div>
</div>


<!-- CHART AREA -->
<div class="row">

    <div class="col-md-6 mb-4">
        <div class="card-custom">
            <h5>Doanh thu (Line)</h5>
            <div class="chart-wrapper"><canvas id="revenueChart"></canvas></div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card-custom">
            <h5>Top Sales (Bar)</h5>
            <div class="chart-wrapper"><canvas id="salesChart"></canvas></div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card-custom">
            <h5>Sản phẩm bán chạy (Pie)</h5>
            <div class="chart-wrapper"><canvas id="categoryChart"></canvas></div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card-custom">
            <h5>Trạng thái đơn hàng</h5>
            <div class="chart-wrapper"><canvas id="orderChart"></canvas></div>
        </div>
    </div>

    <div class="col-md-12 mb-4">
        <div class="card-custom">
            <h5>Đơn hàng theo tháng</h5>
            <div class="chart-wrapper" style="height:320px;"><canvas id="monthlyChart"></canvas></div>
        </div>
    </div>

</div>

</div>

<!-- ============================
     CHART.JS SCRIPT
=============================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // PARSE DATA FROM SERVER
    var revenueLabels = @Html.Raw(Json.Encode(Model.RevenueLabels));
    var revenueData = @Html.Raw(Json.Encode(Model.RevenueData));

    var topLabels = @Html.Raw(Json.Encode(Model.TopProductLabels));
    var topData = @Html.Raw(Json.Encode(Model.TopProductData));

    var catLabels = @Html.Raw(Json.Encode(Model.CategoryLabels));
    var catData = @Html.Raw(Json.Encode(Model.CategoryData));

    var orderLabels = @Html.Raw(Json.Encode(Model.OrderStatusLabels));
    var orderData = @Html.Raw(Json.Encode(Model.OrderStatusData));

    var monthLabels = @Html.Raw(Json.Encode(Model.MonthlyOrderLabels));
    var monthData = @Html.Raw(Json.Encode(Model.MonthlyOrderData));

    // LINE - Revenue
    new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: {
            labels: revenueLabels,
            datasets: [{
                label: "Doanh thu",
                data: revenueData,
                borderColor: '#4e73df',
                backgroundColor: 'rgba(78, 115, 223, 0.05)',
                borderWidth: 3,
                tension: 0.4,
                fill: true
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // BAR - Top Sales
    new Chart(document.getElementById('salesChart'), {
        type: 'bar',
        data: {
            labels: topLabels,
            datasets: [{
                label: "Số lượng bán",
                data: topData,
                backgroundColor: '#1cc88a',
                borderWidth: 1
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // PIE - Category (Product)
    new Chart(document.getElementById('categoryChart'), {
        type: 'pie',
        data: {
            labels: catLabels,
            datasets: [{
                data: catData,
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // DOUGHNUT – Order Status
    new Chart(document.getElementById('orderChart'), {
        type: 'doughnut',
        data: {
            labels: orderLabels,
            datasets: [{
                data: orderData,
                backgroundColor: ['#f6c23e', '#36b9cc', '#1cc88a', '#e74a3b']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // LINE – Monthly Orders
    new Chart(document.getElementById('monthlyChart'), {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: "Đơn hàng",
                data: monthData,
                borderColor: '#36b9cc',
                backgroundColor: 'rgba(54, 185, 204, 0.05)',
                borderWidth: 3,
                tension: 0.35,
                fill: true
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
</script>
