@model IEnumerable<WebBanGIay.Models.TAIKHOAN>
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "User Management";

    var page = ViewBag.Page ?? 1;
    var totalPages = ViewBag.TotalPages ?? 1;
    var query = ViewBag.Query as string ?? "";
}

<style>
    .user-page {
        color: var(--text-main);
        padding: 24px;
        font-family: "Inter", sans-serif;
    }

    .page-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 22px;
    }

    .page-title {
        font-size: 26px;
        font-weight: 700;
        color: var(--text-main);
    }

    .search-box input {
        background: var(--bg-body);
        border: 1px solid var(--border-color);
        color: var(--text-main);
        border-radius: 8px;
        padding: 10px 14px;
        width: 220px;
        transition: 0.2s;
    }
    
    .search-box input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px var(--bg-active);
        outline: none;
    }

    .search-box button {
        padding: 10px 16px;
        border-radius: 8px;
        background: var(--accent-color);
        color: #fff;
        border: none;
    }

    .btn-add-user {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        color: var(--text-main);
        padding: 10px 16px;
        font-weight: 600;
        border-radius: 8px;
        text-decoration: none;
        transition: 0.2s;
    }
    
    .btn-add-user:hover {
        background: var(--bg-hover);
        color: var(--accent-color);
        border-color: var(--accent-color);
    }

    .table-wrapper {
        background: var(--bg-card);
        border-radius: 10px;
        border: 1px solid var(--border-color);
        overflow: hidden;
        box-shadow: var(--shadow-card);
    }

    .table-users {
        width: 100%;
        border-collapse: collapse;
    }

    .table-users thead {
        background: var(--bg-hover);
    }

    .table-users th {
        padding: 18px 16px;
        text-transform: uppercase;
        color: var(--text-label);
        font-size: 0.78rem;
        font-weight: 600;
        border-bottom: 2px solid var(--border-color);
    }

    .table-users td {
        padding: 18px 16px;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.95rem;
        color: var(--text-main);
        vertical-align: middle;
    }

    .table-users tbody tr {
        background: var(--bg-card);
        transition: background .25s;
    }

    .table-users tbody tr:hover {
        background: var(--bg-hover);
    }

    .role-badge {
        padding: 6px 12px;
        font-size: .85rem;
        border-radius: 6px;
        font-weight: 700;
        display: inline-block;
    }

    .role-admin { background: rgba(231, 74, 59, 0.15); color: #e74a3b; border: 1px solid rgba(231, 74, 59, 0.3); }
    .role-employee { background: rgba(54, 185, 204, 0.15); color: #36b9cc; border: 1px solid rgba(54, 185, 204, 0.3); }
    .role-customer { background: rgba(28, 200, 138, 0.15); color: #1cc88a; border: 1px solid rgba(28, 200, 138, 0.3); }

    .btn-square {
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: var(--bg-body);
        border: 1px solid var(--border-color);
        color: var(--text-muted);
        margin-left: 6px;
        font-size: 16px;
        transition: .2s;
        text-decoration: none;
    }

    .btn-square:hover {
        background: var(--accent-color);
        color: #fff;
        border-color: var(--accent-color);
        transform: translateY(-2px);
    }

    .paging {
        margin-top: 22px;
        display: flex;
        gap: 8px;
        justify-content: center;
    }

    .page-link {
        background: var(--bg-card);
        padding: 8px 14px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        color: var(--text-main);
        text-decoration: none;
        transition: 0.2s;
    }

    .page-link:hover {
        background: var(--accent-color);
        color: #fff;
        border-color: var(--accent-color);
    }

    .page-link.active {
        background: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
    }
    
    .page-link.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: var(--bg-body);
    }
</style>

<div class="user-page container-fluid">
    <div class="page-top">
        <div class="page-title">User Management</div>
        <div style="display:flex; gap:12px; align-items:center;">
            <form method="get" class="search-box">
                <input type="text" name="q" placeholder="Search user..." value="@query">
                <button class="btn-search" type="submit">
                    <i class="bi bi-search"></i>
                </button>
            </form>
            <a href="@Url.Action("CreateUser","Admin")" class="btn-add-user">
                <i class="bi bi-plus-circle"></i> Create User
            </a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill"></i> @TempData["Success"]
        </div>
    }

    <div class="table-wrapper">
        <table class="table-users">
            <thead>
                <tr>
                    <th>User name</th>
                    <th>Role</th>
                    <th>Customer</th>
                    <th>Employee</th>
                    <th>Created</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model == null || !Model.Any())
                {
                    <tr>
                        <td colspan="6" style="padding:40px; text-align:center;">No users found</td>
                    </tr>
                }
                else
                {
                    foreach (var u in Model)
                    {
                        var badgeClass = "role-customer";
                        if (!string.IsNullOrEmpty(u.LOAITAIKHOAN))
                        {
                            var role = u.LOAITAIKHOAN.ToUpper();
                            if (role.Contains("QUẢN") || role.Contains("ADMIN"))
                            {
                                badgeClass = "role-admin";
                            }
                            else if (role.Contains("NHÂN") || role.Contains("VIÊN"))
                            {
                                badgeClass = "role-employee";
                            }
                        }

                        <tr>
                            <td>@u.TENTAIKHOAN</td>
                            <td>
                                <span class="role-badge @badgeClass">@u.LOAITAIKHOAN</span>
                            </td>
                            <td>@(!string.IsNullOrEmpty(u.MAKHACHHANG) ? u.MAKHACHHANG : "—")</td>
                            <td>@(!string.IsNullOrEmpty(u.MANHANVIEN) ? u.MANHANVIEN : "—")</td>
                            <td>@u.NGAYTAO</td>
                            <td class="text-center">
                                <a class="btn-square" href="@Url.Action("DetailsUser","Admin", new{ id = u.MATAIKHOAN.Trim() })">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a class="btn-square" href="@Url.Action("EditUser","Admin", new{ id = u.MATAIKHOAN.Trim() })">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a class="btn-square" href="@Url.Action("DeleteUser","Admin", new{ id = u.MATAIKHOAN.Trim() })" 
                                   onclick="return confirm('Delete this user?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="paging">
        <a class="page-link @(page <= 1 ? "disabled" : "")" 
           href="@Url.Action("Users","Admin", new { q = query, page = page - 1 })">Previous</a>

        @for (int i = 1; i <= totalPages; i++)
        {
            <a class="page-link @(i == page ? "active" : "")" 
               href="@Url.Action("Users","Admin", new { q = query, page = i })">@i</a>
        }

        <a class="page-link @(page >= totalPages ? "disabled" : "")" 
           href="@Url.Action("Users","Admin", new { q = query, page = page + 1 })">Next</a>
    </div>
</div>

<script>
    document.querySelectorAll(".page-link.disabled")
        .forEach(e => e.addEventListener("click", evt => evt.preventDefault()));
</script>
