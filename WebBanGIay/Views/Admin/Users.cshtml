@model IEnumerable<WebBanGIay.Models.TAIKHOAN>
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "User Management";

    var page = ViewBag.Page ?? 1;
    var totalPages = ViewBag.TotalPages ?? 1;
    var query = ViewBag.Query as string ?? "";
}

<style>
    .user-page {
        color: #d8e5f7;
        padding: 24px;
        font-family: "Inter", sans-serif;
    }

    .page-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 22px;
    }

    .page-title {
        font-size: 26px;
        font-weight: 700;
        color: #f5f9ff;
    }

    .search-box input {
        background: #0c1525;
        border: 1px solid #26354b;
        color: #e8f1ff;
        border-radius: 8px;
        padding: 10px 14px;
        width: 220px;
    }

    .search-box button {
        padding: 10px 16px;
        border-radius: 8px;
        background: #2663ff;
        color: #fff;
        border: none;
    }

    .btn-add-user {
        background: #14283f;
        border: 1px solid rgba(255,255,255,0.06);
        color: #fff;
        padding: 10px 16px;
        font-weight: 600;
        border-radius: 8px;
        text-decoration: none;
    }

    .table-wrapper {
        background: #0c1624;
        border-radius: 10px;
        border: 1px solid #1b2b41;
        overflow: hidden;
    }

    .table-users {
        width: 100%;
        border-collapse: collapse;
    }

    .table-users thead {
        background: #111f33;
    }

    .table-users th {
        padding: 18px 16px;
        text-transform: uppercase;
        color: #adcae8;
        font-size: 0.78rem;
    }

    .table-users td {
        padding: 18px 16px;
        border-bottom: 1px solid rgba(255,255,255,0.04);
        font-size: 0.95rem;
        color: #e4edf7;
    }

    .table-users tbody tr {
        background: #0a121d;
        transition: background .25s;
    }

    .table-users tbody tr:hover {
        background: #162538;
    }

    .role-badge {
        padding: 8px 16px;
        font-size: .85rem;
        border-radius: 6px;
        font-weight: 700;
    }

    .role-admin { background: #e95353; }
    .role-employee { background: #4cb0ff; }
    .role-customer { background: #22d1b3; }

    .btn-square {
        width: 38px;
        height: 38px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: #121b2b;
        border: 1px solid rgba(255,255,255,0.06);
        color: #fff;
        margin-left: 8px;
        font-size: 18px;
        transition: .2s;
    }

    .btn-square:hover {
        background: #1d2a41;
    }

    .paging {
        margin-top: 22px;
        display: flex;
        gap: 8px;
    }

    .page-link {
        background: #0a1524;
        padding: 10px 16px;
        border-radius: 8px;
        border: 1px solid #1c2e49;
        color: #cfe2ff;
        text-decoration: none;
    }

    .page-link:hover {
        background: #12345c;
    }

    .page-link.active {
        background: #2563ff;
        color: white;
    }
</style>

<div class="user-page container-fluid">
    <div class="page-top">
        <div class="page-title">User Management</div>
        <div style="display:flex; gap:12px; align-items:center;">
            <form method="get" class="search-box">
                <input type="text" name="q" placeholder="Search user..." value="@query">
                <button class="btn-search" type="submit">
                    <i class="bi bi-search"></i>
                </button>
            </form>
            <a href="@Url.Action("CreateUser","Admin")" class="btn-add-user">
                <i class="bi bi-plus-circle"></i> Create User
            </a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill"></i> @TempData["Success"]
        </div>
    }

    <div class="table-wrapper">
        <table class="table-users">
            <thead>
                <tr>
                    <th>User name</th>
                    <th>Role</th>
                    <th>Customer</th>
                    <th>Employee</th>
                    <th>Created</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model == null || !Model.Any())
                {
                    <tr>
                        <td colspan="6" style="padding:40px; text-align:center;">No users found</td>
                    </tr>
                }
                else
                {
                    foreach (var u in Model)
                    {
                        var badgeClass = "role-customer";
                        if (!string.IsNullOrEmpty(u.LOAITAIKHOAN))
                        {
                            var role = u.LOAITAIKHOAN.ToUpper();
                            if (role.Contains("QUẢN") || role.Contains("ADMIN"))
                            {
                                badgeClass = "role-admin";
                            }
                            else if (role.Contains("NHÂN") || role.Contains("VIÊN"))
                            {
                                badgeClass = "role-employee";
                            }
                        }

                        <tr>
                            <td>@u.TENTAIKHOAN</td>
                            <td>
                                <span class="role-badge @badgeClass">@u.LOAITAIKHOAN</span>
                            </td>
                            <td>@(!string.IsNullOrEmpty(u.MAKHACHHANG) ? u.MAKHACHHANG : "—")</td>
                            <td>@(!string.IsNullOrEmpty(u.MANHANVIEN) ? u.MANHANVIEN : "—")</td>
                            <td>@u.NGAYTAO</td>
                            <td class="text-center">
                                <a class="btn-square" href="@Url.Action("DetailsUser","Admin", new{ id = u.MATAIKHOAN.Trim() })">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a class="btn-square" href="@Url.Action("EditUser","Admin", new{ id = u.MATAIKHOAN.Trim() })">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a class="btn-square" href="@Url.Action("DeleteUser","Admin", new{ id = u.MATAIKHOAN.Trim() })" 
                                   onclick="return confirm('Delete this user?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="paging">
        <a class="page-link @(page <= 1 ? "disabled" : "")" 
           href="@Url.Action("Users","Admin", new { q = query, page = page - 1 })">Previous</a>

        @for (int i = 1; i <= totalPages; i++)
        {
            <a class="page-link @(i == page ? "active" : "")" 
               href="@Url.Action("Users","Admin", new { q = query, page = i })">@i</a>
        }

        <a class="page-link @(page >= totalPages ? "disabled" : "")" 
           href="@Url.Action("Users","Admin", new { q = query, page = page + 1 })">Next</a>
    </div>
</div>

<script>
    document.querySelectorAll(".page-link.disabled")
        .forEach(e => e.addEventListener("click", evt => evt.preventDefault()));
</script>
